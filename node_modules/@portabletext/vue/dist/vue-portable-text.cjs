"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const y=require("vue");function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?D(Object(n),!0).forEach(function(r){q(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function q(e,t,n){return t=F(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function F(e){var t=H(e,"string");return typeof t=="symbol"?t:String(t)}function H(e,t){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function T(e){return e._type==="span"&&"text"in e&&typeof e.text=="string"&&(typeof e.marks>"u"||Array.isArray(e.marks)&&e.marks.every(t=>typeof t=="string"))}function L(e){return typeof e._type=="string"&&e._type[0]!=="@"&&(!("markDefs"in e)||!e.markDefs||Array.isArray(e.markDefs)&&e.markDefs.every(t=>typeof t._key=="string"))&&"children"in e&&Array.isArray(e.children)&&e.children.every(t=>typeof t=="object"&&"_type"in t)}function A(e){return L(e)&&"listItem"in e&&typeof e.listItem=="string"&&(typeof e.level>"u"||typeof e.level=="number")}function E(e){return e._type==="@list"}function N(e){return e._type==="@span"}function U(e){return e._type==="@text"}const M=["strong","em","code","underline","strike-through"];function R(e,t,n){if(!T(e)||!e.marks)return[];if(!e.marks.length)return[];const r=e.marks.slice(),c={};return r.forEach(i=>{c[i]=1;for(let s=t+1;s<n.length;s++){const f=n[s];if(f&&T(f)&&Array.isArray(f.marks)&&f.marks.indexOf(i)!==-1)c[i]++;else break}}),r.sort((i,s)=>z(c,i,s))}function z(e,t,n){const r=e[t],c=e[n];if(r!==c)return c-r;const i=M.indexOf(t),s=M.indexOf(n);return i!==s?i-s:t.localeCompare(n)}function V(e){var t;const{children:n,markDefs:r=[]}=e;if(!n||!n.length)return[];const c=n.map(R),i={_type:"@span",children:[],markType:"<unknown>"};let s=[i];for(let f=0;f<n.length;f++){const d=n[f];if(!d)continue;const w=c[f]||[];let b=1;if(s.length>1)for(b;b<s.length;b++){const o=((t=s[b])==null?void 0:t.markKey)||"",u=w.indexOf(o);if(u===-1)break;w.splice(u,1)}s=s.slice(0,b);let l=s[s.length-1];if(l){for(const o of w){const u=r.find(m=>m._key===o),h=u?u._type:o,a={_type:"@span",_key:d._key,children:[],markDef:u,markType:h,markKey:o};l.children.push(a),s.push(a),l=a}if(T(d)){const o=d.text.split(`
`);for(let u=o.length;u-- >1;)o.splice(u,0,`
`);l.children=l.children.concat(o.map(u=>({_type:"@text",text:u})))}else l.children=l.children.concat(d)}}return i.children}function G(e,t){const n=[];let r;for(let c=0;c<e.length;c++){const i=e[c];if(i){if(!A(i)){n.push(i),r=void 0;continue}if(!r){r=O(i,c,t),n.push(r);continue}if(J(i,r)){r.children.push(i);continue}if((i.level||1)>r.level){const s=O(i,c,t);if(t==="html"){const f=r.children[r.children.length-1],d=B(B({},f),{},{children:[...f.children,s]});r.children[r.children.length-1]=d}else r.children.push(s);r=s;continue}if((i.level||1)<r.level){const s=n[n.length-1],f=s&&P(s,i);if(f){r=f,r.children.push(i);continue}r=O(i,c,t),n.push(r);continue}if(i.listItem!==r.listItem){const s=n[n.length-1],f=s&&P(s,{level:i.level||1});if(f&&f.listItem===i.listItem){r=f,r.children.push(i);continue}else{r=O(i,c,t),n.push(r);continue}}console.warn("Unknown state encountered for block",i),n.push(i)}}return n}function J(e,t){return(e.level||1)===t.level&&e.listItem===t.listItem}function O(e,t,n){return{_type:"@list",_key:"".concat(e._key||"".concat(t),"-parent"),mode:n,level:e.level||1,listItem:e.listItem,children:[e]}}function P(e,t){const n=t.level||1,r=t.listItem||"normal",c=typeof t.listItem=="string";if(E(e)&&(e.level||1)===n&&c&&(e.listItem||"normal")===r)return e;if(!("children"in e))return;const i=e.children[e.children.length-1];return i&&!T(i)?P(i,t):void 0}const Q=/^\s/,X=/^\s/;function Y(e){const t=Array.isArray(e)?e:[e];let n="";return t.forEach((r,c)=>{if(!L(r))return;let i=!1;r.children.forEach(s=>{T(s)?(n+=i&&n&&!X.test(n)&&!Q.test(s.text)?" ":"",n+=s.text,i=!1):i=!0}),c!==t.length-1&&(n+=`

`)}),n}function C(e){let t="";return e.children.forEach(n=>{U(n)?t+=n.text:N(n)&&(t+=C(n))}),t}const Z="html";function K(e,t){const{block:n,list:r,listItem:c,marks:i,types:s,...f}=t;return{...e,block:I(e,t,"block"),list:I(e,t,"list"),listItem:I(e,t,"listItem"),marks:I(e,t,"marks"),types:I(e,t,"types"),...f}}function I(e,t,n){const r=t[n],c=e[n];return typeof r=="function"||r&&typeof c=="function"?r:r?{...c,...r}:c}const p=e=>(t,{slots:n})=>{var r;return y.h(e,(r=n.default)==null?void 0:r.call(n))},ee=({value:e},{slots:t})=>{var n;return y.h("a",{href:e==null?void 0:e.href},(n=t.default)==null?void 0:n.call(t))},te={textDecoration:"underline"},ne={code:p("code"),em:p("em"),link:ee,"strike-through":p("del"),strong:p("strong"),underline:(e,{slots:t})=>{var n;return y.h("span",{style:te},(n=t.default)==null?void 0:n.call(t))}},re={number:p("ol"),bullet:p("ul")},ie=p("li"),x=(e,t)=>`[@portabletext/vue] Unknown ${e}, specify a component for it in the \`components.${t}\` prop`,W=e=>x(`block type "${e}"`,"types"),le=e=>x(`mark type "${e}"`,"marks"),oe=e=>x(`block style "${e}"`,"block"),se=e=>x(`list style "${e}"`,"list"),ce=e=>x(`list item style "${e}"`,"listItem");function ue(e){console.warn(e)}const j={display:"none"},ae=({value:e,isInline:t})=>{const n=W(e._type);return t?y.h("span",{style:j},n):y.h("div",{style:j},n)},fe=({markType:e},{slots:t})=>{var n;return y.h("span",{class:`unknown__pt__mark__${e}`},(n=t.default)==null?void 0:n.call(t))},ye=p("p"),pe=p("ul"),he=p("li"),ke=()=>y.h("br"),de={normal:p("p"),blockquote:p("blockquote"),h1:p("h1"),h2:p("h2"),h3:p("h3"),h4:p("h4"),h5:p("h5"),h6:p("h6")},S={types:{},block:de,marks:ne,list:re,listItem:ie,hardBreak:ke,unknownType:ae,unknownMark:fe,unknownList:pe,unknownListItem:he,unknownBlockStyle:ye},me=(e,t=!1)=>n=>{if(t){const{value:r,...c}=n;return y.h(e,{...c,...r})}return y.h(e,{...n.value})},ge=(e,t)=>{function n(l){const{node:o,index:u,isInline:h}=l,a=o._key||`node-${u}`;return E(o)?i(o,u,a):A(o)?c(o,u,a):N(o)?s(o,u,a):r(o)?b(o,u,a,h):L(o)?f(o,u,a,h):U(o)?d(o,a):w(o,u,a,h)}function r(l){return l._type in e.types}function c(l,o,u){const h=$({node:l,index:o,isInline:!1,renderNode:n}),a=e.listItem,g=(typeof a=="function"?a:a[l.listItem])||e.unknownListItem;if(g===e.unknownListItem){const _=l.listItem||"bullet";t(ce(_),{type:_,nodeType:"listItemStyle"})}let k=h.children;if(l.style&&l.style!=="normal"){const{listItem:_,...v}=l;k=n({node:v,index:o,isInline:!1,renderNode:n})}return y.h(g,{key:u,value:l,index:o,isInline:!1,renderNode:n},()=>k)}function i(l,o,u){const h=l.children.map((k,_)=>n({node:k._key?k:{...k,_key:`li-${o}-${_}`},index:_,isInline:!1,renderNode:n})),a=e.list,g=(typeof a=="function"?a:a[l.listItem])||e.unknownList;if(g===e.unknownList){const k=l.listItem||"bullet";t(se(k),{nodeType:"listStyle",type:k})}return y.h(g,{key:u,value:l,index:o,isInline:!1,renderNode:n},()=>h)}function s(l,o,u){const{markDef:h,markType:a,markKey:m}=l,g=e.marks[a]||e.unknownMark,k=l.children.map((_,v)=>n({node:_,index:v,isInline:!0,renderNode:n}));return g===e.unknownMark&&t(le(a),{nodeType:"mark",type:a}),y.h(g,{key:u,text:C(l),value:h,markType:a,markKey:m,renderNode:n},()=>k)}function f(l,o,u,h){const{_key:a,children:m,...g}=$({node:l,index:o,isInline:h,renderNode:n}),k=g.node.style||"normal",v=(typeof e.block=="function"?e.block:e.block[k])||e.unknownBlockStyle;return v===e.unknownBlockStyle&&t(oe(k),{nodeType:"blockStyle",type:k}),y.h(v,{key:u,...g,value:g.node,renderNode:n},()=>m)}function d(l,o){if(l.text===`
`){const u=e.hardBreak;return u?y.h(u,{key:o}):`
`}return l.text}function w(l,o,u,h){const a={value:l,isInline:h,index:o,renderNode:n};t(W(l._type),{nodeType:"block",type:l._type});const m=e.unknownType;return y.h(m,{key:u,...a})}function b(l,o,u,h){const a={value:l,isInline:h,index:o,renderNode:n},m=e.types[l._type];return m?y.h(m,{key:u,...a}):void 0}return n};function $(e){const{node:t,index:n,isInline:r,renderNode:c}=e,s=V(t).map((f,d)=>c({node:f,isInline:!0,index:d,renderNode:c}));return{_key:t._key||`block-${n}`,children:s,index:n,isInline:r,node:t}}const be=y.defineComponent({__name:"vue-portable-text",props:{value:{},components:{},onMissingComponent:{type:[Function,Boolean],default:()=>ue},listNestingMode:{}},setup(e){const t=e;function n(){}const r=t.onMissingComponent||n,c=Array.isArray(t.value)?t.value:[t.value],i=G(c,t.listNestingMode||Z),s=t.components?K(S,t.components):S,f=ge(s,r),d=i.map((b,l)=>f({node:b,index:l,isInline:!1,renderNode:f})),w=()=>d;return(b,l)=>(y.openBlock(),y.createBlock(w))}});exports.PortableText=be;exports.defaultComponents=S;exports.flattenProps=me;exports.mergeComponents=K;exports.toPlainText=Y;
